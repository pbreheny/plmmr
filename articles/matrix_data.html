<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>If your data is in a matrix or data frame • plmmr</title>
<script src="../katex-auto.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><link href="../deps/KaTex-0.16.10/katex.min.css" rel="stylesheet">
<script src="../deps/KaTex-0.16.10/katex.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="If your data is in a matrix or data frame">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">plmmr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/getting-started.html">Start here - getting to know plmmr</a></li>
    <li><a class="dropdown-item" href="../articles/matrix_data.html">If your data is a matrix or data frame</a></li>
    <li><a class="dropdown-item" href="../articles/plink_files.html">If your data is in PLINK files</a></li>
    <li><a class="dropdown-item" href="../articles/delim_files.html">If your data is in (a) delimited file(s)</a></li>
    <li><a class="dropdown-item" href="../articles/notation.html">Notes on notation</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/pbreheny/plmmr"><span class="fa fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>If your data is in a matrix or data frame</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/pbreheny/plmmr/blob/master/vignettes/articles/matrix_data.Rmd" class="external-link"><code>vignettes/articles/matrix_data.Rmd</code></a></small>
      <div class="d-none name"><code>matrix_data.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pbreheny.github.io/plmmr/">plmmr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: bigalgebra</span></span>
<span><span class="co">#&gt; Loading required package: bigmemory</span></span></code></pre></div>
<p>In this overview, I will provide a demo of the main functions in
<code>plmmr</code> using the <code>admix</code> data. Checkout the other
vignettes to see examples of analyzing data from PLINK files or
delimited files.</p>
<p>Examine what we have in the <code>admix</code> data:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">admix</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 3</span></span>
<span><span class="co">#&gt;  $ X       : int [1:197, 1:100] 0 0 0 0 1 0 1 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">#&gt;   .. ..$ : NULL</span></span>
<span><span class="co">#&gt;   .. ..$ : chr [1:100] "Snp1" "Snp2" "Snp3" "Snp4" ...</span></span>
<span><span class="co">#&gt;  $ y       : num [1:197, 1] 3.52 3.754 1.191 0.579 4.085 ...</span></span>
<span><span class="co">#&gt;  $ ancestry: num [1:197] 1 1 1 1 1 1 1 1 1 1 ...</span></span></code></pre></div>
<div class="section level2">
<h2 id="basic-model-fitting">Basic model fitting<a class="anchor" aria-label="anchor" href="#basic-model-fitting"></a>
</h2>
<p>The <code>admix</code> dataset is now ready to analyze with a call to
<code><a href="../reference/plmm.html">plmmr::plmm()</a></code> (one of the main functions in
<code>plmmr</code>):</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">admix_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plmm.html">plmm</a></span><span class="op">(</span><span class="va">admix</span><span class="op">$</span><span class="va">X</span>, <span class="va">admix</span><span class="op">$</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">admix_fit</span>, lambda <span class="op">=</span> <span class="va">admix_fit</span><span class="op">$</span><span class="va">lambda</span><span class="op">[</span><span class="fl">50</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; lasso-penalized regression model with n=197, p=101 at lambda=0.01426</span></span>
<span><span class="co">#&gt; -------------------------------------------------</span></span>
<span><span class="co">#&gt; The model converged </span></span>
<span><span class="co">#&gt; -------------------------------------------------</span></span>
<span><span class="co">#&gt; # of non-zero coefficients:  88 </span></span>
<span><span class="co">#&gt; -------------------------------------------------</span></span></code></pre></div>
<p>Notice: I am passing <code>admix$X</code> as the <code>design</code>
argument in <code><a href="../reference/plmm.html">plmm()</a></code>; internally, <code><a href="../reference/plmm.html">plmm()</a></code> has
taken this <code>X</code> input and created a <code>plmm_design</code>
object. You could also supply <code>X</code> and <code>y</code> to
<code><a href="../reference/create_design.html">create_design()</a></code> to make this step explicit.</p>
<p>The returned <code>beta_vals</code> item is a matrix whose rows are
<span class="math inline">\hat\beta</span> coefficients and whose
columns represent values of the penalization parameter <span class="math inline">\lambda</span>. By default, <code>plmm</code> fits
100 values of <span class="math inline">\lambda</span> (see the
<code>setup_lambda</code> function for details).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">admix_fit</span><span class="op">$</span><span class="va">beta_vals</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="fl">97</span><span class="op">:</span><span class="fl">100</span><span class="op">]</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">3</span>,</span>
<span>               format <span class="op">=</span> <span class="st">"html"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
0.00054
</th>
<th style="text-align:right;">
0.00050
</th>
<th style="text-align:right;">
0.00047
</th>
<th style="text-align:right;">
0.00044
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
7.037
</td>
<td style="text-align:right;">
7.038
</td>
<td style="text-align:right;">
7.038
</td>
<td style="text-align:right;">
7.039
</td>
</tr>
<tr>
<td style="text-align:left;">
Snp1
</td>
<td style="text-align:right;">
-0.937
</td>
<td style="text-align:right;">
-0.937
</td>
<td style="text-align:right;">
-0.937
</td>
<td style="text-align:right;">
-0.937
</td>
</tr>
<tr>
<td style="text-align:left;">
Snp2
</td>
<td style="text-align:right;">
0.217
</td>
<td style="text-align:right;">
0.218
</td>
<td style="text-align:right;">
0.218
</td>
<td style="text-align:right;">
0.218
</td>
</tr>
<tr>
<td style="text-align:left;">
Snp3
</td>
<td style="text-align:right;">
2.991
</td>
<td style="text-align:right;">
2.991
</td>
<td style="text-align:right;">
2.992
</td>
<td style="text-align:right;">
2.992
</td>
</tr>
<tr>
<td style="text-align:left;">
Snp4
</td>
<td style="text-align:right;">
0.193
</td>
<td style="text-align:right;">
0.193
</td>
<td style="text-align:right;">
0.193
</td>
<td style="text-align:right;">
0.193
</td>
</tr>
<tr>
<td style="text-align:left;">
Snp5
</td>
<td style="text-align:right;">
0.883
</td>
<td style="text-align:right;">
0.884
</td>
<td style="text-align:right;">
0.884
</td>
<td style="text-align:right;">
0.885
</td>
</tr>
<tr>
<td style="text-align:left;">
Snp6
</td>
<td style="text-align:right;">
-0.085
</td>
<td style="text-align:right;">
-0.085
</td>
<td style="text-align:right;">
-0.085
</td>
<td style="text-align:right;">
-0.085
</td>
</tr>
<tr>
<td style="text-align:left;">
Snp7
</td>
<td style="text-align:right;">
0.092
</td>
<td style="text-align:right;">
0.092
</td>
<td style="text-align:right;">
0.092
</td>
<td style="text-align:right;">
0.092
</td>
</tr>
<tr>
<td style="text-align:left;">
Snp8
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
Snp9
</td>
<td style="text-align:right;">
0.192
</td>
<td style="text-align:right;">
0.192
</td>
<td style="text-align:right;">
0.192
</td>
<td style="text-align:right;">
0.192
</td>
</tr>
</tbody>
</table>
<p>Note that for all values of <span class="math inline">\lambda</span>,
SNP 8 has <span class="math inline">\hat \beta = 0</span>. This is
because SNP 8 is a constant feature, a feature (i.e., a column of <span class="math inline">\mathbf{X}</span>) whose values do not vary among
the members of this population.</p>
<p>We can summarize our fit at the nth <span class="math inline">\lambda</span> value:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># for n = 25 </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">admix_fit</span>, lambda <span class="op">=</span> <span class="va">admix_fit</span><span class="op">$</span><span class="va">lambda</span><span class="op">[</span><span class="fl">25</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; lasso-penalized regression model with n=197, p=101 at lambda=0.08163</span></span>
<span><span class="co">#&gt; -------------------------------------------------</span></span>
<span><span class="co">#&gt; The model converged </span></span>
<span><span class="co">#&gt; -------------------------------------------------</span></span>
<span><span class="co">#&gt; # of non-zero coefficients:  46 </span></span>
<span><span class="co">#&gt; -------------------------------------------------</span></span></code></pre></div>
<p>We can also plot the path of the fit to see how model coefficients
vary with <span class="math inline">\lambda</span>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">admix_fit</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="matrix_data_files/figure-html/admix_plots-1.png" alt="Plot of path for model fit" width="768"><p class="caption">
Plot of path for model fit
</p>
</div>
<p>Suppose we also know the ancestry groups with which for each person
in the <code>admix</code> data self-identified. We would probably want
to include this in the model as an unpenalized covariate (i.e., we would
want ‘ancestry’ to always be in the model). To specify an unpenalized
covariate, we need to use the <code><a href="../reference/create_design.html">create_design()</a></code> function
prior to calling <code><a href="../reference/plmm.html">plmm()</a></code>. Here is how that would look:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># add ancestry to design matrix</span></span>
<span><span class="va">X_plus_ancestry</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">admix</span><span class="op">$</span><span class="va">ancestry</span>, <span class="va">admix</span><span class="op">$</span><span class="va">X</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># adjust column names -- need these for designating 'unpen' argument</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">X_plus_ancestry</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ancestry"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">admix</span><span class="op">$</span><span class="va">X</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create a design</span></span>
<span><span class="va">admix_design2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_design.html">create_design</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X_plus_ancestry</span>,</span>
<span>                               y <span class="op">=</span> <span class="va">admix</span><span class="op">$</span><span class="va">y</span>,</span>
<span>                               <span class="co"># below, I mark ancestry variable as unpenalized</span></span>
<span>                               <span class="co"># we want ancestry to always be in the model</span></span>
<span>                               unpen <span class="op">=</span> <span class="st">"ancestry"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># now fit a model </span></span>
<span><span class="va">admix_fit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plmm.html">plmm</a></span><span class="op">(</span>design <span class="op">=</span> <span class="va">admix_design2</span><span class="op">)</span></span></code></pre></div>
<p>We may compare the results from the model which includes ‘ancestry’
to our first model:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">admix_fit2</span>, idx <span class="op">=</span> <span class="fl">25</span><span class="op">)</span></span>
<span><span class="co">#&gt; lasso-penalized regression model with n=197, p=102 at lambda=0.09886</span></span>
<span><span class="co">#&gt; -------------------------------------------------</span></span>
<span><span class="co">#&gt; The model converged </span></span>
<span><span class="co">#&gt; -------------------------------------------------</span></span>
<span><span class="co">#&gt; # of non-zero coefficients:  14 </span></span>
<span><span class="co">#&gt; -------------------------------------------------</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">admix_fit2</span><span class="op">)</span></span></code></pre></div>
<p><img src="matrix_data_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="cross-validation">Cross validation<a class="anchor" aria-label="anchor" href="#cross-validation"></a>
</h2>
<p>To select a <span class="math inline">\lambda</span> value, we often
use cross validation. Below is an example of using <code>cv_plmm</code>
to select a <span class="math inline">\lambda</span> that minimizes
cross-validation error:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">admix_cv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cv_plmm.html">cv_plmm</a></span><span class="op">(</span>design <span class="op">=</span> <span class="va">admix_design2</span>, return_fit <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">admix_cv_s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">admix_cv</span>, lambda <span class="op">=</span> <span class="st">"min"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">admix_cv_s</span><span class="op">)</span></span>
<span><span class="co">#&gt; lasso-penalized model with n=197 and p=102</span></span>
<span><span class="co">#&gt; At minimum cross-validation error (lambda=0.1853):</span></span>
<span><span class="co">#&gt; -------------------------------------------------</span></span>
<span><span class="co">#&gt;   Nonzero coefficients: 3</span></span>
<span><span class="co">#&gt;   Cross-validation error (deviance): 1.33</span></span>
<span><span class="co">#&gt;   Scale estimate (sigma): 1.154</span></span></code></pre></div>
<p>We can also plot the cross-validation error (CVE) versus <span class="math inline">\lambda</span> (on the log scale):</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">admix_cv</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="matrix_data_files/figure-html/cvplot-1.png" alt="Plot of CVE" width="768"><p class="caption">
Plot of CVE
</p>
</div>
<div class="section level3">
<h3 id="parallelization">Parallelization<a class="anchor" aria-label="anchor" href="#parallelization"></a>
</h3>
<p>As an option for cross-validation, with data stored in-memory you may
choose to implement CV in parallel using the <code>cluster</code>
argument in <code><a href="../reference/cv_plmm.html">cv_plmm()</a></code>. Here is an example of setting up CV
in parallel:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># make a cluster</span></span>
<span><span class="va">num_cores</span> <span class="op">&lt;-</span> <span class="fl">5</span> <span class="co"># just using 5 cores as a laptop-sized example</span></span>
<span><span class="va">cl</span> <span class="op">&lt;-</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">makeCluster</a></span><span class="op">(</span>spec <span class="op">=</span> <span class="va">num_cores</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">cl</span><span class="op">)</span> <span class="co"># check to see what kind of cluster you've made </span></span>
<span><span class="co">#&gt; socket cluster with 5 nodes on host 'localhost'</span></span>
<span><span class="va">cv_fit_parallel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cv_plmm.html">cv_plmm</a></span><span class="op">(</span>design <span class="op">=</span> <span class="va">admix_design2</span>,</span>
<span>                           type <span class="op">=</span> <span class="st">"blup"</span>,</span>
<span>                           cluster <span class="op">=</span> <span class="va">cl</span>,</span>
<span>                           return_fit <span class="op">=</span> <span class="cn">T</span>,</span>
<span>                           trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># note: the results closely correspond to the above</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">cv_fit_parallel</span><span class="op">)</span></span>
<span><span class="co">#&gt; lasso-penalized model with n=197 and p=102</span></span>
<span><span class="co">#&gt; At minimum cross-validation error (lambda=0.1853):</span></span>
<span><span class="co">#&gt; -------------------------------------------------</span></span>
<span><span class="co">#&gt;   Nonzero coefficients: 3</span></span>
<span><span class="co">#&gt;   Cross-validation error (deviance): 1.30</span></span>
<span><span class="co">#&gt;   Scale estimate (sigma): 1.138</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cv_fit_parallel</span><span class="op">)</span></span></code></pre></div>
<p><img src="matrix_data_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="prediction">Prediction<a class="anchor" aria-label="anchor" href="#prediction"></a>
</h2>
<p>Below is an example of the <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> methods for
PLMMs:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># make predictions for select lambda value(s)</span></span>
<span><span class="va">y_hat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">admix_fit</span>,</span>
<span>                 newX <span class="op">=</span> <span class="va">admix</span><span class="op">$</span><span class="va">X</span>,</span>
<span>                 type <span class="op">=</span> <span class="st">"blup"</span>,</span>
<span>                 X <span class="op">=</span> <span class="va">admix</span><span class="op">$</span><span class="va">X</span><span class="op">)</span></span></code></pre></div>
<p>We can compare these predictions with the predictions we would get
from an intercept-only model using mean squared prediction error (MSPE)
– lower is better:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># intercept-only (or 'null') model</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/crossprod.html" class="external-link">crossprod</a></span><span class="op">(</span><span class="va">admix</span><span class="op">$</span><span class="va">y</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">admix</span><span class="op">$</span><span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">admix</span><span class="op">$</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="co">#&gt;          [,1]</span></span>
<span><span class="co">#&gt; [1,] 5.928528</span></span>
<span></span>
<span><span class="co"># our model at its best value of lambda</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">y_hat</span>, <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">c</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/crossprod.html" class="external-link">crossprod</a></span><span class="op">(</span><span class="va">admix</span><span class="op">$</span><span class="va">y</span> <span class="op">-</span> <span class="va">c</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">c</span><span class="op">)</span><span class="op">}</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">mse</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">mse</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.6930826</span></span>
<span><span class="co"># ^ across all values of lambda, our model has MSPE lower than the null model</span></span></code></pre></div>
<p>We see our model has better predictions than the null.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Tabitha K. Peter, Anna C. Reisetter, Patrick J. Breheny, Yujing Lu.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
